<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Juego estilo Mario</title>
  <style>
    body { margin:0; overflow:hidden; background:#000; }
    canvas { display:block; background:#87ceeb; }

    /* Botones táctiles */
    .controls {
      position: absolute;
      bottom: 20px;
      width: 100%;
      display: flex;
      justify-content: space-between;
      pointer-events: none;
    }
    .left-right {
      display: flex;
      gap: 20px;
      margin-left: 20px;
    }
    .btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: rgba(0,0,0,0.3);
      color: white;
      font-size: 24px;
      text-align: center;
      line-height: 60px;
      user-select: none;
      pointer-events: auto;
    }
    .btn:active { background: rgba(0,0,0,0.5); }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>

  <!-- Botones móviles -->
  <div class="controls">
    <div class="left-right">
      <div class="btn" id="leftBtn">◀</div>
      <div class="btn" id="rightBtn">▶</div>
    </div>
    <div class="btn" id="jumpBtn">⭡</div>
  </div>

  <script>
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  function resizeCanvas(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  resizeCanvas();
  window.addEventListener("resize", resizeCanvas);

  let keys = {left:false,right:false,up:false};
  let cameraX = 0;
  let currentLevel = 0;
  let gameStarted = false;
  let enemyActive = false;
  let playerSpeed = 5;
  let enemySpeedBase = 2.5;

  class Character{
    constructor(x,y,w,h,img=null){
      this.x=x; this.y=y; this.w=w; this.h=h; this.img=img;
      this.vx=0; this.vy=0; this.onGround=false; this.coins=0;
    }
    draw(){
      ctx.fillStyle='red';
      ctx.fillRect(this.x-cameraX,this.y,this.w,this.h);
    }
    update(platforms){
      this.vy += 0.6;
      this.y += this.vy;
      this.x += this.vx;
      this.onGround = false;
      for(let p of platforms){
        if(this.x+this.w>p.x && this.x<p.x+p.w && this.y+this.h>=p.y-10 && this.y+this.h<=p.y+10 && this.vy>=0){
          this.y = p.y-this.h; this.vy=0; this.onGround=true;
        }
      }
    }
  }

  class Platform{
    constructor(x,y,w,h){this.x=x;this.y=y;this.w=w;this.h=h;}
    draw(){ctx.fillStyle='green'; ctx.fillRect(this.x-cameraX,this.y,this.w,this.h);}
  }

  class Coin{
    constructor(x,y){this.x=x;this.y=y;this.radius=10;this.collected=false;}
    draw(){if(!this.collected){ctx.fillStyle='gold'; ctx.beginPath(); ctx.arc(this.x-cameraX,this.y,this.radius,0,Math.PI*2); ctx.fill();}}
  }

  class Obstacle{
    constructor(x,y,w,h){this.x=x; this.y=y; this.w=w; this.h=h;}
    draw(){ctx.fillStyle='brown'; ctx.fillRect(this.x-cameraX,this.y,this.w,this.h);}
  }

  // NIVELES
  const levels = [];
  for(let i=0;i<10;i++){
    let platforms=[]; let coins=[]; let obstacles=[];
    let baseY = canvas.height-100;

    // base más larga
    platforms.push(new Platform(0, baseY, canvas.width*5, 20));
    
    let startX=400; let width=120;
    for(let j=0;j<12;j++){
      let x=startX+j*200;
      let y = baseY - (Math.random()*150);
      platforms.push(new Platform(x,y,width,20));
      if(Math.random()<0.7) coins.push(new Coin(x+50,y-30));
      if(Math.random()<0.4) obstacles.push(new Obstacle(x+Math.random()*50,y-40,30,40));
    }
    
    let lastPlatform = platforms[platforms.length-1];
    let meta = {x:lastPlatform.x + lastPlatform.w/2 - 25, y:lastPlatform.y - 50, w:50, h:50};
    levels.push({bg:`hsl(${i*36},70%,80%)`,platforms,coins,obstacles,meta});
  }

  let player = new Character(100,canvas.height-200,40,40);
  let enemy = new Character(50,canvas.height-200,40,40);

  function startLevel(lvl){
    let level=levels[lvl];
    player.x=100; player.y=canvas.height-200; player.vx=0; player.vy=0;
    enemy.x=50; enemy.y=canvas.height-200; enemy.vx=0; enemy.vy=0;
    enemyActive=true;
  }
  startLevel(currentLevel);

  function drawHUD(){
    ctx.fillStyle="black";
    ctx.font="20px Arial";
    ctx.fillText("Monedas: "+player.coins,20,30);
    ctx.fillText("Nivel: "+(currentLevel+1),20,60);
  }

  function update(){
    let level=levels[currentLevel];
    ctx.fillStyle=level.bg;
    ctx.fillRect(0,0,canvas.width,canvas.height);

    if(keys.left) player.vx=-playerSpeed;
    else if(keys.right) player.vx=playerSpeed;
    else player.vx=0;

    if(keys.up && player.onGround){ player.vy=-12; }

    player.update(level.platforms);
    enemy.update(level.platforms);

    if(enemyActive){
      if(enemy.x<player.x) enemy.vx=enemySpeedBase;
      else if(enemy.x>player.x) enemy.vx=-enemySpeedBase;
    }

    cameraX = Math.max(0, player.x - canvas.width/2);

    level.platforms.forEach(p=>p.draw());
    level.obstacles.forEach(o=>o.draw());
    level.coins.forEach(c=>{
      c.draw();
      if(!c.collected && Math.abs(player.x-c.x)<30 && Math.abs(player.y-c.y)<30){
        c.collected=true; player.coins++;
      }
    });

    ctx.fillStyle="blue"; 
    ctx.fillRect(level.meta.x-cameraX,level.meta.y,level.meta.w,level.meta.h);

    player.draw();
    ctx.fillStyle="purple"; enemy.draw();

    drawHUD();

    if(player.x+player.w>level.meta.x && player.x<level.meta.x+level.meta.w &&
       player.y+player.h>level.meta.y && player.y<level.meta.y+level.meta.h){
      currentLevel++;
      if(currentLevel<levels.length) startLevel(currentLevel);
      else alert("¡Ganaste!");
    }

    requestAnimationFrame(update);
  }
  update();

  // Controles teclado
  window.addEventListener("keydown",e=>{
    if(e.code==="ArrowLeft") keys.left=true;
    if(e.code==="ArrowRight") keys.right=true;
    if(e.code==="ArrowUp") keys.up=true;
  });
  window.addEventListener("keyup",e=>{
    if(e.code==="ArrowLeft") keys.left=false;
    if(e.code==="ArrowRight") keys.right=false;
    if(e.code==="ArrowUp") keys.up=false;
  });

  // Controles táctiles
  function bindBtn(id,action){
    const btn=document.getElementById(id);
    btn.addEventListener("touchstart",()=>{keys[action]=true;});
    btn.addEventListener("touchend",()=>{keys[action]=false;});
  }
  bindBtn("leftBtn","left");
  bindBtn("rightBtn","right");
  bindBtn("jumpBtn","up");

  </script>
</body>
</html>
