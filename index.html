<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Juego estilo Mario</title>
  <style>
    * { margin: 0; padding: 0; }
    canvas { background: skyblue; display: block; }
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 20px;
      font-family: Arial, sans-serif;
      color: #fff;
      text-shadow: 2px 2px 2px black;
    }
    /* Controles móviles */
    #controls {
      position: absolute;
      bottom: 20px;
      width: 100%;
      display: flex;
      justify-content: space-between;
      pointer-events: none;
    }
    .btn {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: rgba(0,0,0,0.3);
      color: white;
      font-size: 30px;
      display: flex;
      justify-content: center;
      align-items: center;
      pointer-events: auto;
      user-select: none;
    }
    #left-right { display: flex; gap: 20px; margin-left: 20px; }
    #jump { margin-right: 20px; }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="ui">Nivel: 1 | Monedas: 0</div>

  <!-- Botones móviles -->
  <div id="controls">
    <div id="left-right">
      <div class="btn" id="left">⮜</div>
      <div class="btn" id="right">⮞</div>
    </div>
    <div class="btn" id="jump">⮝</div>
  </div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

class Player {
  constructor() {
    this.width = 40;
    this.height = 40;
    this.x = 100;
    this.y = canvas.height - 100;
    this.velX = 0;
    this.velY = 0;
    this.speed = 5;
    this.jumpStrength = 15;
    this.onGround = false;
  }
  update() {
    this.velY += 0.8; // gravedad
    this.x += this.velX;
    this.y += this.velY;

    // Colisión con plataformas
    this.onGround = false;
    for (let p of platforms) {
      if (
        this.x < p.x + p.width &&
        this.x + this.width > p.x &&
        this.y + this.height > p.y &&
        this.y + this.height < p.y + p.height
      ) {
        this.y = p.y - this.height;
        this.velY = 0;
        this.onGround = true;
      }
    }
    // Limites laterales
    if (this.x < 0) this.x = 0;
    if (this.x + this.width > canvas.width) this.x = canvas.width - this.width;
  }
  draw() {
    ctx.fillStyle = "red";
    ctx.fillRect(this.x, this.y, this.width, this.height);
  }
}

class Platform {
  constructor(x, y, width, height) {
    this.x = x;
    this.y = y;
    this.width = width;
    this.height = height;
  }
  draw() {
    ctx.fillStyle = "green";
    ctx.fillRect(this.x, this.y, this.width, this.height);
  }
}

class Coin {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.size = 20;
    this.collected = false;
  }
  draw() {
    if (!this.collected) {
      ctx.fillStyle = "yellow";
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size / 2, 0, Math.PI * 2);
      ctx.fill();
    }
  }
}

let player = new Player();
let platforms = [];
let coins = [];
let level = 1;
let coinsCollected = 0;

// Generar nivel
function generateLevel() {
  platforms = [];
  coins = [];

  // Base larga (siempre ocupa todo el ancho)
  platforms.push(new Platform(0, canvas.height - 50, canvas.width, 50));

  // Escaleras / plataformas extras
  for (let i = 1; i <= 5; i++) {
    let x = 150 * i;
    let y = canvas.height - 50 - i * 70;
    platforms.push(new Platform(x, y, 120, 20));
    coins.push(new Coin(x + 40, y - 20));
  }

  // Colocar jugador al inicio
  player.x = 100;
  player.y = canvas.height - 50 - player.height;
  player.velX = 0;
  player.velY = 0;
}
generateLevel();

// Controles
let keys = {};
document.addEventListener("keydown", (e) => {
  keys[e.code] = true;
});
document.addEventListener("keyup", (e) => {
  keys[e.code] = false;
});

// Controles táctiles
const leftBtn = document.getElementById("left");
const rightBtn = document.getElementById("right");
const jumpBtn = document.getElementById("jump");

leftBtn.addEventListener("touchstart", () => keys["ArrowLeft"] = true);
leftBtn.addEventListener("touchend", () => keys["ArrowLeft"] = false);
rightBtn.addEventListener("touchstart", () => keys["ArrowRight"] = true);
rightBtn.addEventListener("touchend", () => keys["ArrowRight"] = false);
jumpBtn.addEventListener("touchstart", () => {
  if (player.onGround) player.velY = -player.jumpStrength;
});

// Ajustar base y jugador en redimensionar
function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  if (platforms.length > 0) {
    platforms[0].x = 0;
    platforms[0].y = canvas.height - 50;
    platforms[0].width = canvas.width;
    platforms[0].height = 50;
  }

  if (player.y + player.height > canvas.height - 50) {
    player.y = canvas.height - 50 - player.height;
    player.velY = 0;
  }
}
window.addEventListener("resize", resizeCanvas);

function update() {
  // Movimiento
  if (keys["ArrowLeft"]) {
    player.velX = -player.speed;
  } else if (keys["ArrowRight"]) {
    player.velX = player.speed;
  } else {
    player.velX = 0;
  }
  if (keys["Space"] || keys["ArrowUp"]) {
    if (player.onGround) player.velY = -player.jumpStrength;
  }

  player.update();

  // Monedas
  for (let c of coins) {
    if (!c.collected &&
      player.x < c.x + c.size &&
      player.x + player.width > c.x &&
      player.y < c.y + c.size &&
      player.y + player.height > c.y
    ) {
      c.collected = true;
      coinsCollected++;
    }
  }

  // Avanzar nivel
  if (player.x > canvas.width - 60) {
    level++;
    generateLevel();
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (let p of platforms) p.draw();
  for (let c of coins) c.draw();
  player.draw();
  document.getElementById("ui").innerText = `Nivel: ${level} | Monedas: ${coinsCollected}`;
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
