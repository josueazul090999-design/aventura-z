<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Juego Mario-like</title>
<style>
  body { margin: 0; overflow: hidden; background: #87CEEB; }
  canvas { display: block; background: #87CEEB; }

  /* HUD */
  #hud {
    position: absolute;
    top: 10px;
    left: 10px;
    font-size: 22px;
    font-weight: bold;
    color: white;
    text-shadow: 2px 2px 3px black;
  }

  /* Controles touch */
  .btn {
    position: absolute;
    width: 70px;
    height: 70px;
    background: rgba(0,0,0,0.3);
    border-radius: 50%;
    text-align: center;
    line-height: 70px;
    font-size: 28px;
    font-weight: bold;
    color: white;
    user-select: none;
  }

  #btnLeft { bottom: 20px; left: 20px; }
  #btnRight { bottom: 20px; left: 110px; }
  #btnJump { bottom: 20px; right: 20px; }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="hud">Monedas: 0 | Nivel: 1</div>

<!-- Botones táctiles -->
<div id="btnLeft" class="btn">⟵</div>
<div id="btnRight" class="btn">⟶</div>
<div id="btnJump" class="btn">⤒</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let baseHeight = 50;
let baseY = 0;

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  baseY = canvas.height - baseHeight;

  if (player) {
    player.y = baseY - player.height;
  }
  generateLevel();
}
window.addEventListener("resize", resizeCanvas);

class Player {
  constructor(x, y, color) {
    this.x = x;
    this.y = y;
    this.width = 40;
    this.height = 40;
    this.color = color;
    this.velX = 0;
    this.velY = 0;
    this.speed = 5;
    this.jumpForce = 15;
    this.onGround = false;
  }
  update() {
    this.velY += 0.8;
    this.x += this.velX;
    this.y += this.velY;

    this.onGround = false;
    for (let p of platforms) {
      if (
        this.x < p.x + p.width &&
        this.x + this.width > p.x &&
        this.y + this.height > p.y &&
        this.y + this.height < p.y + p.height
      ) {
        this.y = p.y - this.height;
        this.velY = 0;
        this.onGround = true;
      }
    }
    if (this.y > canvas.height) {
      resetLevel();
    }
  }
  draw() {
    ctx.fillStyle = this.color;
    ctx.fillRect(this.x, this.y, this.width, this.height);
  }
}

class Enemy {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.width = 40;
    this.height = 40;
    this.color = "red";
    this.speed = 2;
  }
  update() {
    if (player.x > this.x) this.x += this.speed;
    else this.x -= this.speed;

    if (
      player.x < this.x + this.width &&
      player.x + player.width > this.x &&
      player.y < this.y + this.height &&
      player.y + player.height > this.y
    ) {
      resetLevel();
    }
  }
  draw() {
    ctx.fillStyle = this.color;
    ctx.fillRect(this.x, this.y, this.width, this.height);
  }
}

class Platform {
  constructor(x, y, w, h) {
    this.x = x;
    this.y = y;
    this.width = w;
    this.height = h;
  }
  draw() {
    ctx.fillStyle = "green";
    ctx.fillRect(this.x, this.y, this.width, this.height);
  }
}

class Coin {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.size = 15;
    this.collected = false;
  }
  draw() {
    if (!this.collected) {
      ctx.fillStyle = "yellow";
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.fill();
    }
  }
}

let player = new Player(100, 100, "blue");
let enemy = new Enemy(20, 0);
let platforms = [];
let coinsArr = [];
let score = 0;
let level = 1;

function generateLevel() {
  platforms = [];
  coinsArr = [];

  // Base larga
  platforms.push(new Platform(0, baseY, canvas.width, baseHeight));

  // Escalones con monedas
  for (let i = 0; i < 5; i++) {
    let px = 200 + i * 200;
    let py = baseY - (100 + i * 70);
    platforms.push(new Platform(px, py, 120, 20));
    coinsArr.push(new Coin(px + 60, py - 20));
  }

  // Recolocar enemigo siempre sobre la base
  enemy.x = 50;
  enemy.y = baseY - enemy.height;
}

function resetLevel() {
  player.x = 100;
  player.y = baseY - player.height;
  player.velX = 0;
  player.velY = 0;

  enemy.x = 20;
  enemy.y = baseY - enemy.height;
}

function nextLevel() {
  level++;
  enemy.speed += 0.5;
  generateLevel();
  resetLevel();
}

function updateHUD() {
  document.getElementById("hud").innerText = `Monedas: ${score} | Nivel: ${level}`;
}

let keys = {};
window.addEventListener("keydown", e => {
  keys[e.key] = true;
});
window.addEventListener("keyup", e => {
  keys[e.key] = false;
});

// Botones táctiles
function setupTouchButton(btnId, key) {
  const btn = document.getElementById(btnId);
  btn.addEventListener("touchstart", e => {
    e.preventDefault();
    keys[key] = true;
  });
  btn.addEventListener("touchend", e => {
    e.preventDefault();
    keys[key] = false;
  });
}
setupTouchButton("btnLeft", "ArrowLeft");
setupTouchButton("btnRight", "ArrowRight");
setupTouchButton("btnJump", " ");

function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Movimientos
  player.velX = 0;
  if (keys["ArrowLeft"]) player.velX = -player.speed;
  if (keys["ArrowRight"]) player.velX = player.speed;
  if (keys[" "] && player.onGround) {
    player.velY = -player.jumpForce;
    player.onGround = false;
  }

  player.update();
  enemy.update();

  for (let c of coinsArr) {
    if (!c.collected &&
      player.x < c.x + c.size &&
      player.x + player.width > c.x &&
      player.y < c.y + c.size &&
      player.y + player.height > c.y) {
      c.collected = true;
      score++;
      updateHUD();
      if (coinsArr.every(c => c.collected)) nextLevel();
    }
  }

  // Dibujar
  for (let p of platforms) p.draw();
  for (let c of coinsArr) c.draw();
  player.draw();
  enemy.draw();

  requestAnimationFrame(gameLoop);
}

resizeCanvas();
resetLevel();
updateHUD();
gameLoop();
</script>
</body>
</html>
