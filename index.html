<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Juego Mario Style</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #87CEEB;
      font-family: Arial, sans-serif;
    }
    canvas {
      display: block;
      background: linear-gradient(#87CEEB, #E0F6FF);
    }
    #hud {
      position: absolute;
      top: 10px;
      left: 10px;
      color: black;
      font-size: 20px;
      font-weight: bold;
      background: rgba(255,255,255,0.7);
      padding: 6px 10px;
      border-radius: 8px;
    }
    /* Controles táctiles */
    .controls {
      position: absolute;
      bottom: 20px;
      width: 100%;
      display: flex;
      justify-content: space-between;
      pointer-events: none;
    }
    .left-controls, .right-controls {
      display: flex;
      gap: 15px;
      pointer-events: auto;
    }
    .btn {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: rgba(0,0,0,0.3);
      border: 2px solid white;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 24px;
      user-select: none;
      touch-action: none;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="hud">Nivel: 1 | Monedas: 0 | Puntos: 0</div>

  <!-- Controles táctiles -->
  <div class="controls">
    <div class="left-controls">
      <div class="btn" id="btnLeft">⟵</div>
      <div class="btn" id="btnRight">⟶</div>
    </div>
    <div class="right-controls">
      <div class="btn" id="btnJump">⤒</div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const hud = document.getElementById("hud");

    // Estado del juego
    let level = 1;
    let coins = 0;
    let score = 0;
    let keys = { left: false, right: false, up: false };

    class Player {
      constructor(x, y, color) {
        this.x = x;
        this.y = y;
        this.width = 40;
        this.height = 40;
        this.color = color;
        this.velX = 0;
        this.velY = 0;
        this.speed = 5;
        this.jumpForce = 15;
        this.onGround = false;
      }
      update(platforms) {
        // Movimiento horizontal
        if (keys.left) this.velX = -this.speed;
        else if (keys.right) this.velX = this.speed;
        else this.velX = 0;

        // Gravedad
        this.velY += 0.8;

        this.x += this.velX;
        this.y += this.velY;

        this.onGround = false;
        for (let p of platforms) {
          if (this.x < p.x + p.width &&
              this.x + this.width > p.x &&
              this.y + this.height <= p.y + 10 &&
              this.y + this.height + this.velY >= p.y) {
            this.y = p.y - this.height;
            this.velY = 0;
            this.onGround = true;
          }
        }
      }
      jump() {
        if (this.onGround) {
          this.velY = -this.jumpForce;
          this.onGround = false;
        }
      }
      draw() {
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
      }
    }

    class Platform {
      constructor(x, y, width, height) {
        this.x = x;
        this.y = y;
        this.width = width;
        this.height = height;
      }
      draw() {
        ctx.fillStyle = "green";
        ctx.fillRect(this.x, this.y, this.width, this.height);
      }
    }

    class Coin {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.radius = 10;
        this.collected = false;
      }
      draw() {
        if (!this.collected) {
          ctx.fillStyle = "gold";
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
          ctx.fill();
        }
      }
    }

    let player;
    let platforms = [];
    let coinsArr = [];

    function generateLevel() {
      platforms = [];
      coinsArr = [];
      // Base larga
      platforms.push(new Platform(0, canvas.height - 50, canvas.width, 50));
      // Escalones
      for (let i = 0; i < 5; i++) {
        let px = 200 + i * 200;
        let py = canvas.height - (100 + i * 70);
        platforms.push(new Platform(px, py, 120, 20));
        coinsArr.push(new Coin(px + 60, py - 20));
      }
    }

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      generateLevel();
      if (!player) {
        player = new Player(100, canvas.height - 150, "blue");
      } else {
        player.y = canvas.height - player.height - 60; // siempre sobre la base
      }
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Dibujar plataformas
      for (let p of platforms) p.draw();

      // Dibujar monedas
      for (let c of coinsArr) {
        if (!c.collected &&
            player.x < c.x + c.radius &&
            player.x + player.width > c.x - c.radius &&
            player.y < c.y + c.radius &&
            player.y + player.height > c.y - c.radius) {
          c.collected = true;
          coins++;
          score += 100;
        }
        c.draw();
      }

      // Actualizar jugador
      player.update(platforms);
      player.draw();

      // Actualizar HUD
      hud.textContent = `Nivel: ${level} | Monedas: ${coins} | Puntos: ${score}`;

      requestAnimationFrame(gameLoop);
    }
    gameLoop();

    // Controles de teclado
    window.addEventListener("keydown", (e) => {
      if (e.code === "ArrowLeft") keys.left = true;
      if (e.code === "ArrowRight") keys.right = true;
      if (e.code === "Space") player.jump();
    });
    window.addEventListener("keyup", (e) => {
      if (e.code === "ArrowLeft") keys.left = false;
      if (e.code === "ArrowRight") keys.right = false;
    });

    // Controles táctiles
    function bindButton(btn, action, isJump = false) {
      btn.addEventListener("touchstart", (e) => {
        e.preventDefault();
        if (isJump) player.jump();
        else keys[action] = true;
      });
      btn.addEventListener("touchend", (e) => {
        e.preventDefault();
        if (!isJump) keys[action] = false;
      });
    }
    bindButton(document.getElementById("btnLeft"), "left");
    bindButton(document.getElementById("btnRight"), "right");
    bindButton(document.getElementById("btnJump"), null, true);
  </script>
</body>
</html>
